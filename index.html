<!DOCTYPE html>
<html lang="it">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="Buon compleanno Maria! Un piccolo pensiero per te.">
    <title>Buon compleanno Maria!</title>
    <link rel="stylesheet" href="index.css?v=32">
    <link rel="icon" href="assets/favicon.ico" type="image/x-icon">
    <!-- Preload critical fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Caveat:wght@400;500;600;700&family=Dancing+Script:wght@400;600;700&family=Lora:ital,wght@0,400;0,500;0,600;1,400&family=Inter:wght@300;400;500&display=swap"
        rel="stylesheet">
</head>

<body>
    <!-- Background Elements -->
    <div class="background-animation"></div>
    <div class="floating-hearts" id="floatingHearts"></div>

    <!-- Modals Container -->
    <div class="modal-overlay active" id="mainModalOverlay">

        <!-- 1. Intro Step -->
        <div class="modal-step active" id="stepIntro">
            <div class="modal-card glass-effect">
                <div class="progress-dots">
                    <span class="dot active"></span>
                    <span class="dot"></span>
                    <span class="dot"></span>
                </div>
                <div class="modal-icon">üíï</div>
                <h1 class="modal-title">X accedere a qst pensierino dv prima farti un test...</h1>
                <button class="btn-primary" onclick="nextStep('stepQuiz')">Inizia! üíñ</button>
            </div>
        </div>

        <!-- 2. Quiz Step -->
        <div class="modal-step" id="stepQuiz">
            <div class="modal-card glass-effect">
                <div class="progress-dots">
                    <span class="dot completed">‚úì</span>
                    <span class="dot active"></span>
                    <span class="dot"></span>
                </div>
                <h2 class="modal-title">Qual √® il mio kolore preferito? üé®ü§î</h2>
                <div class="quiz-options">
                    <button class="btn-option" onclick="checkAnswer(this, 'arancione')">Arancione üß°</button>
                    <button class="btn-option" onclick="checkAnswer(this, 'viola')">Viola üíú</button>
                    <button class="btn-option" onclick="checkAnswer(this, 'blu')">Blu üíô</button>
                    <button class="btn-option" onclick="checkAnswer(this, 'rosso')">Rosso ‚ù§Ô∏è</button>
                </div>
                <p class="feedback-text" id="quizFeedback"></p>
            </div>
        </div>

        <!-- 3. Love Slider Step -->
        <div class="modal-step" id="stepSlider">
            <div class="modal-card glass-effect">
                <div class="progress-dots">
                    <span class="dot completed">‚úì</span>
                    <span class="dot completed">‚úì</span>
                    <span class="dot active"></span>
                </div>
                <h2 class="modal-title">E qnt ti amo sekondo te...? üìè‚ù§Ô∏è</h2>

                <div class="slider-wrapper">
                    <div class="slider-value" id="sliderValue">0</div>
                    <input type="range" min="0" max="999999" value="0" class="love-slider" id="loveSlider">
                    <div class="slider-labels">
                        <span>Poco ü§è</span>
                        <span>Tanto üôå</span>
                        <span>Infinito ‚ôæÔ∏è</span>
                    </div>
                </div>

                <button class="btn-primary" id="submitSlider" onclick="checkSlider()">Conferma ‚ù§Ô∏èü•∞</button>
                <p class="feedback-text" id="sliderFeedback"></p>
            </div>
        </div>

    </div>

    <!-- Main Content (Hidden initially) -->
    <main class="main-content" id="mainContent">

        <div class="content-wrapper">

            <!-- Top Gallery Section -->
            <section class="gallery-section gallery-top">
                <div class="polaroid-container">
                    <div class="polaroid p1" onclick="openLightbox('assets/1.JPG')">
                        <div class="polaroid-inner"><img src="assets/1.JPG" alt="Ricordo 1" loading="lazy"></div>
                    </div>
                    <div class="polaroid p2" onclick="openLightbox('assets/2.JPG')">
                        <div class="polaroid-inner"><img src="assets/2.JPG" alt="Ricordo 2" loading="lazy"></div>
                    </div>
                    <div class="polaroid p3" onclick="openLightbox('assets/3.JPG')">
                        <div class="polaroid-inner"><img src="assets/3.JPG" alt="Ricordo 3" loading="lazy"></div>
                    </div>
                    <div class="polaroid p4" onclick="openLightbox('assets/4.JPG')">
                        <div class="polaroid-inner"><img src="assets/4.JPG" alt="Ricordo 4" loading="lazy"></div>
                    </div>
                    <div class="polaroid p5" onclick="openLightbox('assets/5.JPG')">
                        <div class="polaroid-inner"><img src="assets/5.JPG" alt="Ricordo 5" loading="lazy"></div>
                    </div>
                    <div class="polaroid p6" onclick="openLightbox('assets/6.JPG')">
                        <div class="polaroid-inner"><img src="assets/6.JPG" alt="Ricordo 6" loading="lazy"></div>
                    </div>
                    <div class="polaroid p7" onclick="openLightbox('assets/7.JPG')">
                        <div class="polaroid-inner"><img src="assets/7.JPG" alt="Ricordo 7" loading="lazy"></div>
                    </div>
                    <div class="polaroid p8" onclick="openLightbox('assets/8.JPG')">
                        <div class="polaroid-inner"><img src="assets/8.JPG" alt="Ricordo 8" loading="lazy"></div>
                    </div>
                </div>
            </section>

            <!-- Title Header -->
            <header class="hero-header">
                <div class="header-content">
                    <h1 class="title-script">Buon Komplelanno</h1>
                    <p class="subtitle">A MIA MOGLIE!!!</p>
                </div>
            </header>

            <!-- Letter Section -->
            <section class="letter-section">
                <article class="paper-letter">
                    <div class="letter-content">

                        <h2 class="letter-greeting">X la mia Maria</h2>

                        <div class="poem" id="poem">
                            <p class="stanza">
                                <span class="drop-cap">O</span>ggi √® festa per una bimba speciale,<br>
                                morpida, unica, eccezionale,<br>
                                anche se spesso, tra un riso e un problema,<br>
                                sa essere dolke, ma un pochino scema...
                            </p>

                            <div class="poem-divider">üíï</div>

                            <p class="stanza">
                                Amo di te la tua pankia soave,<br>
                                dei miei desideri possiedi la chiave,<br>
                                i fianki, le kurve, quel modo di fare:<br>
                                sei kos√¨ bll, tutta da lekkeggiare...
                            </p>

                            <div class="poem-divider">üíó</div>

                            <p class="stanza">
                                Il tempo con te √® un regalo del destino,<br>
                                benedico ogni bakio e ogni grattino,<br>
                                respiro con te, nella gioia e nei guai,<br>
                                anche quando... un po' d'aria tu fai...
                            </p>

                            <div class="poem-divider">üíñ</div>

                            <p class="stanza">
                                Quest'anno ripaga ogni tuo sacrificio,<br>
                                √® l'alba di un nuovo, stupendo inizio.<br>
                                Auguri piccola, mio immenso amore,<br>
                                ti amo cos√¨ forte che mi scoppia il kuore.
                            </p>
                        </div>

                        <div class="signature" id="signature">
                            <p>X sempre tuo,</p>
                            <p class="sig-name">Karmine. <span
                                    style="font-size: 0.6em; margin-left: 10px; color: var(--text-light);">16 dicembre
                                    2025</span></p>
                            <span class="heart-icon">‚ù§Ô∏è</span>
                        </div>
                    </div>
                </article>
            </section>

            <!-- Bottom Gallery Section -->
            <section class="gallery-section gallery-bottom">
                <div class="polaroid-container">
                    <div class="polaroid p9" onclick="openLightbox('assets/9.JPG')">
                        <div class="polaroid-inner"><img src="assets/9.JPG" alt="Ricordo 9" loading="lazy"></div>
                    </div>
                    <div class="polaroid p10" onclick="openLightbox('assets/10.JPG')">
                        <div class="polaroid-inner"><img src="assets/10.JPG" alt="Ricordo 10" loading="lazy"></div>
                    </div>
                    <div class="polaroid p11" onclick="openLightbox('assets/11.jpg')">
                        <div class="polaroid-inner"><img src="assets/11.jpg" alt="Ricordo 11" loading="lazy"></div>
                    </div>
                    <div class="polaroid p12" onclick="openLightbox('assets/12.JPG')">
                        <div class="polaroid-inner"><img src="assets/12.JPG" alt="Ricordo 12" loading="lazy"></div>
                    </div>
                    <div class="polaroid p13" onclick="openLightbox('assets/13.JPG')">
                        <div class="polaroid-inner"><img src="assets/13.JPG" alt="Ricordo 13" loading="lazy"></div>
                    </div>
                    <div class="polaroid p14" onclick="openLightbox('assets/14.JPG')">
                        <div class="polaroid-inner"><img src="assets/14.JPG" alt="Ricordo 14" loading="lazy"></div>
                    </div>
                    <div class="polaroid p15" onclick="openLightbox('assets/15.JPG')">
                        <div class="polaroid-inner"><img src="assets/15.JPG" alt="Rico5rdo 15" loading="lazy"></div>
                    </div>
                    <div class="polaroid p16" onclick="openLightbox('assets/16.JPG')">
                        <div class="polaroid-inner"><img src="assets/16.JPG" alt="Ricordo 16" loading="lazy"></div>
                    </div>
                </div>
            </section>

        </div>

        <footer>
            <p>Fatto cn il ‚ù§Ô∏è da Karmine x te</p>
        </footer>
    </main>

    <!-- Music Player -->
    <div class="music-player" id="musicPlayer">
        <button class="music-btn" id="musicBtn" onclick="toggleMusic()">
            <span class="music-icon">üéµ</span>
            <span class="music-label">Riproduci</span>
        </button>
        <audio id="bgMusic" loop>
            <source src="assets/music.mp3" type="audio/mpeg">
        </audio>
    </div>

    <!-- Lightbox -->
    <div class="lightbox" id="lightbox">
        <button class="lightbox-close" onclick="closeLightbox()">&times;</button>
        <button class="lightbox-nav lightbox-prev" onclick="navigateLightbox(-1)">‚ùÆ</button>
        <div class="lightbox-content" onclick="closeLightbox()">
            <img id="lightboxImg" src="" alt="">
        </div>
        <button class="lightbox-nav lightbox-next" onclick="navigateLightbox(1)">‚ùØ</button>
    </div>

    <script>
        // --- Logic ---

        // State
        const CORRECT_COLOR = 'viola';
        const MAX_SLIDER = 999999;

        // Gallery images for lightbox navigation
        const galleryImages = [
            'assets/1.JPG', 'assets/2.JPG', 'assets/3.JPG', 'assets/4.JPG',
            'assets/5.JPG', 'assets/6.JPG', 'assets/7.JPG', 'assets/8.JPG',
            'assets/9.JPG', 'assets/10.JPG', 'assets/11.jpg', 'assets/12.JPG',
            'assets/13.JPG', 'assets/14.JPG', 'assets/15.JPG', 'assets/16.JPG'
        ];
        let currentImageIndex = 0;

        // Elements
        const modalOverlay = document.getElementById('mainModalOverlay');
        const mainContent = document.getElementById('mainContent');
        const slider = document.getElementById('loveSlider');
        const sliderVal = document.getElementById('sliderValue');

        // Navigation
        function nextStep(stepId) {
            // Hide all active steps
            document.querySelectorAll('.modal-step').forEach(el => {
                el.classList.remove('active');
                el.style.display = 'none'; // Ensure they are hidden
            });

            // Show new step
            const next = document.getElementById(stepId);
            next.style.display = 'flex';
            // Small delay to allow display:flex to apply before adding opacity class
            setTimeout(() => next.classList.add('active'), 10);
        }

        // Quiz Logic
        function checkAnswer(btn, answer) {
            const feedback = document.getElementById('quizFeedback');
            const allBtns = document.querySelectorAll('.btn-option');

            // Disable buttons temporarily
            allBtns.forEach(b => b.style.pointerEvents = 'none');

            if (answer === CORRECT_COLOR) {
                btn.classList.add('correct');
                feedback.textContent = "Brv... Ci siamo quasi...";
                feedback.className = "feedback-text success";

                setTimeout(() => {
                    nextStep('stepSlider');
                }, 1500);
            } else {
                btn.classList.add('wrong');
                feedback.textContent = "Ma...";
                feedback.className = "feedback-text error";

                setTimeout(() => {
                    btn.classList.remove('wrong');
                    allBtns.forEach(b => b.style.pointerEvents = 'auto');
                    feedback.textContent = "";
                }, 1500);
            }
        }

        // Slider Logic
        slider.addEventListener('input', (e) => {
            const val = parseInt(e.target.value);
            if (val === MAX_SLIDER) {
                sliderVal.textContent = "‚àû";
                sliderVal.classList.add('pulse');
            } else {
                sliderVal.textContent = val.toLocaleString('it-IT');
                sliderVal.classList.remove('pulse');
            }
        });

        function checkSlider() {
            const val = parseInt(slider.value);
            const feedback = document.getElementById('sliderFeedback');
            const oneThird = MAX_SLIDER / 3;
            const twoThirds = (MAX_SLIDER / 3) * 2;

            if (val === MAX_SLIDER) {
                feedback.textContent = "WOW 6 BRAVISSIMA! hai vnt il premio!";
                feedback.className = "feedback-text success";

                // Unlock site
                setTimeout(() => {
                    modalOverlay.classList.add('fade-out');
                    setTimeout(() => {
                        modalOverlay.style.display = 'none';
                        mainContent.classList.add('visible');
                        startConfetti();
                        startPoemAnimation();
                        startMusic();
                        centerCarousels();
                    }, 800);
                }, 1500);

            } else if (val < oneThird) {
                feedback.textContent = "Scordatelo.";
                feedback.className = "feedback-text error";
            } else if (val < twoThirds) {
                feedback.textContent = "Sono arrabbiato.";
                feedback.className = "feedback-text error";
            } else {
                feedback.textContent = "Ma per chi mi hai preso. üò†";
                feedback.className = "feedback-text error";
            }
        }

        // Lightbox Logic with Navigation
        function openLightbox(src) {
            const lb = document.getElementById('lightbox');
            const img = document.getElementById('lightboxImg');
            currentImageIndex = galleryImages.findIndex(img => img.toLowerCase() === src.toLowerCase());
            if (currentImageIndex === -1) currentImageIndex = 0;
            img.src = src;
            lb.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeLightbox() {
            const lb = document.getElementById('lightbox');
            lb.classList.remove('active');
            document.body.style.overflow = '';
        }

        function navigateLightbox(direction) {
            event.stopPropagation();
            currentImageIndex += direction;
            if (currentImageIndex < 0) currentImageIndex = galleryImages.length - 1;
            if (currentImageIndex >= galleryImages.length) currentImageIndex = 0;
            document.getElementById('lightboxImg').src = galleryImages[currentImageIndex];
        }

        // Keyboard navigation for lightbox
        document.addEventListener('keydown', (e) => {
            const lb = document.getElementById('lightbox');
            if (!lb.classList.contains('active')) return;

            if (e.key === 'ArrowLeft') navigateLightbox(-1);
            if (e.key === 'ArrowRight') navigateLightbox(1);
            if (e.key === 'Escape') closeLightbox();
        });

        // Music Player
        let musicPlaying = false;

        function startMusic() {
            const audio = document.getElementById('bgMusic');
            const btn = document.getElementById('musicBtn');
            const label = btn.querySelector('.music-label');
            const icon = btn.querySelector('.music-icon');

            audio.play().then(() => {
                musicPlaying = true;
                label.textContent = 'Pausa';
                icon.textContent = 'üé∂';
                btn.classList.add('playing');
            }).catch(() => {
                // Autoplay blocked, user needs to click
                console.log('Autoplay blocked, click to play');
            });
        }

        function toggleMusic() {
            const audio = document.getElementById('bgMusic');
            const btn = document.getElementById('musicBtn');
            const label = btn.querySelector('.music-label');
            const icon = btn.querySelector('.music-icon');

            if (musicPlaying) {
                audio.pause();
                label.textContent = 'Riproduci';
                icon.textContent = 'üéµ';
                btn.classList.remove('playing');
            } else {
                audio.play();
                label.textContent = 'Pausa';
                icon.textContent = 'üé∂';
                btn.classList.add('playing');
            }
            musicPlaying = !musicPlaying;
        }


        // Poem Animation - Typewriter + Stanza Fade-in (Sequential)
        async function startPoemAnimation() {
            const stanzas = document.querySelectorAll('.stanza');
            const dividers = document.querySelectorAll('.poem-divider');
            const signature = document.getElementById('signature');

            // Animate stanzas one by one, waiting for each to finish
            for (let i = 0; i < stanzas.length; i++) {
                stanzas[i].classList.add('visible');
                await typewriterEffect(stanzas[i]);

                // Show divider after stanza (if exists)
                if (dividers[i]) {
                    dividers[i].classList.add('visible');
                    await delay(500); // Short pause after divider
                }
            }

            // Reveal signature after poem is complete
            await delay(300);
            signature.classList.add('visible');
        }

        function delay(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        function typewriterEffect(element) {
            return new Promise((resolve) => {
                const dropCap = element.querySelector('.drop-cap');
                let dropCapLetter = '';

                // If there's a drop cap, save it and remove from DOM temporarily
                if (dropCap) {
                    dropCapLetter = dropCap.textContent;
                    dropCap.remove();
                }

                // Get text without drop cap
                let text = element.textContent;

                // Clear content
                element.innerHTML = '';

                // Re-add drop cap if exists
                if (dropCapLetter) {
                    const newDropCap = document.createElement('span');
                    newDropCap.className = 'drop-cap';
                    newDropCap.textContent = dropCapLetter;
                    element.appendChild(newDropCap);
                }

                // Create a span for the typed text
                const typedSpan = document.createElement('span');
                element.appendChild(typedSpan);

                let charIndex = 0;
                const speed = 25; // ms per character

                function type() {
                    if (charIndex < text.length) {
                        // Handle line breaks
                        if (text.charAt(charIndex) === '\n') {
                            typedSpan.innerHTML += '<br>';
                        } else {
                            typedSpan.textContent += text.charAt(charIndex);
                        }
                        charIndex++;
                        setTimeout(type, speed);
                    } else {
                        // Typing finished, resolve the promise
                        resolve();
                    }
                }

                type();
            });
        }

        // Center carousels on mobile
        function centerCarousels() {
            const carousels = document.querySelectorAll('.polaroid-container');
            carousels.forEach(carousel => {
                // Scroll to center
                const scrollWidth = carousel.scrollWidth;
                const clientWidth = carousel.clientWidth;
                const scrollTo = (scrollWidth - clientWidth) / 2;
                carousel.scrollLeft = scrollTo;
            });
        }

        // Floating Hearts Animation
        function createHeart() {
            const heart = document.createElement('div');
            heart.classList.add('heart');
            heart.innerHTML = ['‚ù§Ô∏è', 'üíñ', 'üíï', 'üíó'][Math.floor(Math.random() * 4)];
            heart.style.left = Math.random() * 100 + 'vw';
            heart.style.animationDuration = (Math.random() * 3 + 2) + 's';
            heart.style.opacity = Math.random() * 0.5 + 0.3;

            document.getElementById('floatingHearts').appendChild(heart);

            setTimeout(() => {
                heart.remove();
            }, 5000);
        }

        setInterval(createHeart, 800);

        // Simple Confetti for success
        function startConfetti() {
            for (let i = 0; i < 50; i++) {
                setTimeout(createHeart, i * 50);
            }
        }

    </script>
</body>

</html>